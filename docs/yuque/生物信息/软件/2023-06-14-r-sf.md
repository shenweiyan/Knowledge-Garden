---
title: è¿™ä¸ª R åŒ…æŠ˜è…¾äº†ä¸€å¤©ç»ˆäºå®‰è£…ä¸Šäº†
urlname: 2023-06-14-r-sf
author: ç« é±¼çŒ«å…ˆç”Ÿ
date: 2023-06-14
updated: "2023-08-24 11:16:13"
---

äº‹æƒ…èµ·å› äºåœ¨æ¨ç‰¹çœ‹åˆ°å…³äº`ggVennDiagram`è¿™ä¸ª R åŒ…æ•™ç¨‹çš„ä¸€æ¡æ¨æ–‡ï¼Œæƒ³ç€å»å¤ç°ä¸€ä¸‹ï¼Œäºæ˜¯å¼€å§‹å»å®‰è£…ï¼Œä¸æ–™å®‰è£…è¿‡ç¨‹ä¸­å‡ºç°äº†`sf`è¿™ä¸ªä¾èµ–åŒ…å§‹ç»ˆå®‰è£…ä¸æˆåŠŸçš„ä¸€å †é”™è¯¯ï¼Œäºæ˜¯æœ‰äº†è¿™ä¸€ç¯‡æ–‡ç« ï¼Œç‰¹æ­¤è®°å½•ä¸€ä¸‹ï¼Œä¹Ÿå¸Œæœ›ç»™é‡åˆ°ç±»ä¼¼é—®é¢˜çš„å°ä¼™ä¼´ä¸€ä¸ªå‚è€ƒã€‚

## ç¬¬ä¸€ä¸ªé”™è¯¯

é¦–å…ˆè¯´æ˜ä¸€ä¸‹ï¼Œæˆ‘ç”¨çš„ R ç‰ˆæœ¬æ˜¯ 4.3.0ï¼ŒLinux ç³»ç»Ÿæ˜¯ Red Hat 6.5ã€‚
æœ€å¼€å§‹å®‰è£…`sf`è¿™ä¸ª R åŒ…é‡åˆ°çš„ç¬¬ä¸€ä¸ª error æ˜¯ GDAL/GEOS/Proj.4 ç‰ˆæœ¬ä¸ç¬¦åˆè¦æ±‚çš„æç¤ºã€‚
![image.png](https://shub.weiyan.tech/yuque/elog-cookbook-img/FtlKgbSLps692sB0pokkqd6pQBm4.png)
äºæ˜¯ï¼Œå¼€å§‹æ‰‹åŠ¨å»å®‰è£… GDAL/GEOS/Proj.4ï¼Œä¹‹æ‰€ä»¥é€‰æ‹©åŸºäºæ™®é€šç”¨æˆ·æ‰‹åŠ¨å»æºç ç¼–è¯‘å®‰è£…ï¼Œä¸»è¦ä¸€ä¸ªåŸå› æ˜¯ç³»ç»Ÿç‰ˆæœ¬å¤ªè€ï¼Œç¬¬äºŒå‡ºäºå®‰å…¨è€ƒè™‘é¿å… root å¸¦æ¥çš„ä¸€ç³»åˆ—éº»çƒ¦ã€‚

ä¸€ç•ªæŠ˜è…¾ï¼ŒæŠŠ **gdal-2.2.3+geos-3.4.0+proj-4.9.1** éƒ½è£…å¥½äº†ï¼Œè®¾ç½®å®Œ **PATH+LD_LIBRARY_PATH** åï¼Œå´æ‚²å‚¬çš„å‡ºç°ç±»ä¼¼è¿™ä¸ªçš„æŠ¥é”™ï¼š<https://github.com/r-spatial/sf/issues/678> â€”â€” è¿™æ˜¯`sf`åŒ…çš„ä¸€ä¸ªé”™è¯¯ï¼

äºæ˜¯ï¼Œé—®é¢˜å˜æˆäº†å¦‚ä½•æˆåŠŸå»å®‰è£…`sf`åŒ…ï¼Œæˆ–è€…è¯´å¦‚ä½•è§£å†³`sf`çš„ **proj_conf_test.c:4:28: error: expected ')' before 'const'** å®‰è£…é”™è¯¯ã€‚

## sf åŒ…ä¾èµ–ä¸è§£å†³

åœ¨`sf`åŒ…çš„ <https://github.com/r-spatial/sf#linux> ä¸­æ˜ç¡®æåˆ°äº†è¿™ä¸ªåŒ…éœ€è¦ä¾èµ– GDAL/GEOS/Proj.4ï¼Œå…·ä½“ç‰ˆæœ¬è¦æ±‚å¦‚ä¸‹ã€‚

> ğŸ“¢ **For Unix-alikes, GDAL (>= 2.0.1), GEOS (>= 3.4.0) and Proj.4 (>= 4.8.0) are required.**

åæ¥ç»è¿‡ä¸€ç•ªçš„æŠ˜è…¾å°è¯•ï¼Œæ‰å‘ç°ï¼š

1. **gdal-2.2.3+geos-3.4.0+proj-4.9.1** å‡ºç°ç±»ä¼¼[è¿™ä¸ª](https://github.com/r-spatial/sf/issues/678)çš„æŠ¥é”™ â€”â€” **proj_conf_test.c:4:28: error: expected ')' before 'const'**ï¼
2. **gdal-2.2.0+geos-3.4.0+proj-4.8.0** çš„ç»„åˆå¯ä»¥è§£å†³ä»¥ä¸Šé‡åˆ°çš„é—®é¢˜ï¼
3. **æ‰‹åŠ¨æºç å®‰è£…çš„è¯ï¼ŒProj.4 è¦å…ˆäº GDAL å®‰è£…ï¼Œå› ä¸º GDAL å®‰è£…çš„æ—¶å€™éœ€è¦æŒ‡å®š Proj.4 è¿›è¡Œç¼–è¯‘ã€‚**

### GEOS

1. è¦æ±‚ GEOS version >= 3.4.0ï¼›

```bash
export PATH=/Bioinfo/Pipeline/SoftWare/gcc-4.8.5/bin:$PATH
wget https://download.osgeo.org/geos/geos-3.4.0.tar.bz2
tar xvjf geos-3.4.0.tar.bz2 -C ../build/
cd ../build/geos-3.4.0
./configure --prefix=/Bioinfo/Pipeline/SoftWare/geos-3.4.0
make -j4 && make install
```

### Proj.4

1. è¦æ±‚ Proj.4 (>= 4.8.0) ï¼›
2. **Proj.4 è¦å…ˆäº GDAL å®‰è£…ï¼**

```bash
export PATH=/Bioinfo/Pipeline/SoftWare/gcc-4.8.5/bin:$PATH
wget https://download.osgeo.org/proj/proj-4.8.0.tar.gz
tar zvxf proj-4.8.0.tar.gz -C ../build/
cd ../build/proj-4.8.0/
./configure --prefix=/Bioinfo/Pipeline/SoftWare/proj-4.8.0
make -j4 && make install
```

### GDAL

1. è¦æ±‚ GDAL version >= 2.0.1ï¼›è®°ä½ä¸€å®šè¦åŠ  **--with-static-proj4** è¿›è¡Œç¼–è¯‘ï¼Œå¦åˆ™ <https://github.com/r-spatial/sf/issues/678> è¿™ä¸ªé—®é¢˜æ²¡æ³•è§£å†³ï¼ï¼
2. å°è¯•äº†ä¸€ä¸‹ **gdal-2.2.3+proj-4.9.1** ç»„åˆï¼Œå¥½åƒæœ‰é—®é¢˜ï¼ˆ**configure: error: GDALAllRegister not found in libgdal**ï¼‰ï¼›

![image.png](https://shub.weiyan.tech/yuque/elog-cookbook-img/FlfgB4IbTnfSdtgFBbXwTw9Upwms.png)

3.  ä½†æ˜¯ GDAL-2.2.0+proj-4.8.0 æ˜¯å¯ä»¥çš„ï¼

```bash
$enabledevtoolset4
wget http://download.osgeo.org/gdal/2.2.0/gdal-2.2.0.tar.gz
tar zvxf gdal-2.2.0.tar.gz -C ../build/
cd ../build/gdal-2.2.0
./configure --prefix=/Bioinfo/Pipeline/SoftWare/gdal-2.2.0 --with-static-proj4=/Bioinfo/Pipeline/SoftWare/proj-4.8.0/
make -j4 && make install
```

### æœ€ç»ˆå®‰è£…å‘½ä»¤

```bash
export PATH=/Bioinfo/Pipeline/SoftWare/gdal-2.2.0/bin:/Bioinfo/Pipeline/SoftWare/geos-3.4.0/bin:/Bioinfo/Pipeline/SoftWare/proj-4.8.0/bin:$PATH
export LD_LIBRARY_PATH=/Bioinfo/Pipeline/SoftWare/gdal-2.2.0/lib:/Bioinfo/Pipeline/SoftWare/geos-3.4.0/lib:/Bioinfo/Pipeline/SoftWare/proj-4.8.0/lib:$LD_LIBRARY_PATH
```

å‡ºç° **configure: error: libproj not found in standard or given locations.** å¼‚å¸¸ï¼Œå‚è€ƒï¼š<https://github.com/r-spatial/sf/issues/1471> å¾—åˆ°è§£å†³ï¼š

```bash
# configure: error: libproj not found in standard or given locations.
options("repos"=c(CRAN="https://mirrors.tuna.tsinghua.edu.cn/CRAN/"))
install.packages('sf', configure.args='--with-gdal-config=/Bioinfo/Pipeline/SoftWare/gdal-2.2.0/bin/gdal-config --with-geos-config=/Bioinfo/Pipeline/SoftWare/geos-3.4.0/bin/geos-config --with-proj-include=/Bioinfo/Pipeline/SoftWare/proj-4.8.0/include --with-proj-lib=/Bioinfo/Pipeline/SoftWare/proj-4.8.0/lib', configure.vars='GDAL_DATA=/Bioinfo/Pipeline/SoftWare/gdal-2.2.0/share/gdal')
```

## ä½¿ç”¨è¯´æ˜

å®‰è£…å®Œ`sf`å’Œ`ggVennDiagram` åï¼Œå¦‚æœè¦ä½¿ç”¨è¿™ä¸¤ä¸ªåŒ…ï¼Œåˆ™éœ€è¦ï¼š

```bash
export LD_LIBRARY_PATH=/Bioinfo/Pipeline/SoftWare/gdal-2.2.0/lib:/Bioinfo/Pipeline/SoftWare/geos-3.4.0/lib:/Bioinfo/Pipeline/SoftWare/proj-4.8.0/lib:$LD_LIBRARY_PATH
```

![image.png](https://shub.weiyan.tech/yuque/elog-cookbook-img/Fk8F_-rrGUUjSv4dynyiGMZXOteH.png)
